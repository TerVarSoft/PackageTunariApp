"use strict";angular.module("tunariApp",["ngAnimate","ngRoute","angular-carousel","restangular","ngAudio","nya.bootstrap.select","siyfion.sfTypeahead","angularUtils.directives.dirPagination"]).config(["$routeProvider","RestangularProvider",function(a,b){b.setBaseUrl("http://10.0.0.5:8000/api"),b.setResponseExtractor(function(a,b,c,d){return"getList"===b?_.each(a,function(a){a.id=a._id}):a._id&&(a.id=a._id),a}),a.when("/",{templateUrl:"views/productSearch.html",controller:"ProductSearcherCtrl",controllerAs:"ProductSearcher"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/productSearch",{templateUrl:"views/productSearch.html",controller:"ProductSearcherCtrl",controllerAs:"ProductSearcher"}).when("/products/:productId",{templateUrl:"views/editproduct.html",controller:"EditproductCtrl",controllerAs:"editProduct"}).when("/newProduct",{templateUrl:"views/newProduct.html",controller:"NewproductCtrl",controllerAs:"newProduct"}).when("/clientSearch",{templateUrl:"views/clientSearch.html",controller:"ClientSearchCtrl",controllerAs:"clientSearch"}).when("/clientSamples/:clientId",{templateUrl:"views/clientSamples.html",controller:"ClientSamplesCtrl",controllerAs:"clientSamples"}).when("/newClient",{templateUrl:"views/newClient.html",controller:"NewClientCtrl",controllerAs:"newClient"}).when("/clients/:clientId",{templateUrl:"views/editClient.html",controller:"EditClientCtrl",controllerAs:"editClient"}).otherwise({redirectTo:"/"})}]),angular.module("tunariApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("tunariApp").controller("ClientSamplesCtrl",["Clients","Products","ServerData","$scope","$location","$routeParams",function(a,b,c,d,e,f){d.serverData=c,d.distributedOptions=["Todos","Repartidos","No Repartidos"],d.distributedOption=d.distributedOptions[0],d.client={},a.one(f.clientId).get().then(function(a){d.client=a,d.savedProductSamples=a.productSamples.slice(0)}),b.getList().then(function(a){d.products=a}),d.filterDistributedOptions=function(a){var b=!0;return"Repartidos"==d.distributedOption?b=d.isDistributed(a):"No Repartidos"==d.distributedOption&&(b=!d.isDistributed(a)),b},d.isDistributed=function(a){var b=!1;return b=_.some(d.client.productSamples,function(b){return b==a})},d.addSample=function(a){_.contains(d.client.productSamples,a)?d.client.productSamples=_.without(d.client.productSamples,a):d.client.productSamples.push(a)},d.saveModification=function(){d.client.save().then(function(){e.path("/clientSearch")})},d.cancelModifications=function(){d.client.productSamples=d.savedProductSamples.slice(0),e.path("/clientSearch")},d.toogleMark=function(){d.isAllMarked?(d.client.productSamples=[],d.isAllMarked=!1):(d.isAllMarked=!0,d.client.productSamples=_.pluck(d.products,"name"))}}]),angular.module("tunariApp").controller("ClientSearchCtrl",["$scope","$location","Clients",function(a,b,c){c.getList().then(function(b){a.clients=b,a.pagination={},a.pagination.pageSize=10,a.pagination.numberOfPages=Math.ceil(a.clients.length/a.pagination.pageSize)}),a.search=function(){c.getList({name:a.selectedClient.name}).then(function(b){a.clients=b})},a.editClient=function(a){b.path("/clients/"+a)},a.showProductSamples=function(a){b.path("/clientSamples/"+a)},a.windowTop=function(){window.scrollTo(0,0)}}]),angular.module("tunariApp").controller("EditClientCtrl",["$scope","$location","Clients","$routeParams",function(a,b,c,d){c.one(d.clientId).get().then(function(b){a.client=b,a.savedClient=$.extend(!0,{},a.client)}),a.saveClient=function(){a.client.save().then(function(){b.path("/clientSearch")})},a.cancelEditClient=function(){a.client=$.extend(!0,{},a.savedClient),b.path("/clientSearch")},a.deleteClient=function(){c.one(d.clientId).remove().then(function(){$("#deleteModal").modal("toggle"),$(".modal-backdrop").remove(),b.path("/clientSearch")})}}]),angular.module("tunariApp").controller("EditproductCtrl",["$scope","$location","$routeParams","Products","ServerData","AlertMessages",function(a,b,c,d,e,f){a.editingProduct=d.one(c.productId).get().then(function(b){a.editingProduct=b}),a.serverData=e,a.saveProduct=function(){a.editingProduct.put().then(function(){var c="Acaba de modificar "+a.editingProduct.name;f.setMessage(c),b.path("/productSearch")})},a.cancelEditing=function(){b.path("/productSearch")},a.deleteProduct=function(){d.one(c.productId).remove().then(function(){$("#deleteModal").on("hidden.bs.modal",function(){b.path("/productSearch")})})}}]),angular.module("tunariApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("tunariApp").controller("NewClientCtrl",["$scope","$location","Clients",function(a,b,c){a.createClient=function(){a.newClient.productSamples=[],c.post(a.newClient).then(function(){b.path("/clientSearch")})},a.cancelNewClient=function(){b.path("/clientSearch")},$("#name").focus()}]),angular.module("tunariApp").controller("NewproductCtrl",["$scope","$location","ServerData","Products","AlertMessages",function(a,b,c,d,e){window.scrollTo(0,0),a.serverData=c,a.saveProduct=function(){var c="Acaba de crear "+a.newProduct.name;e.setMessage(c),b.path("/productSearch")},a.createProduct=function(){a.newProduct.tags.push(a.newProduct.name),a.newProduct.tags.push(a.newProduct.category),a.newProduct.tags.push(a.newProduct.properties.size),a.newProduct.tags.push(a.newProduct.properties.type),a.newProduct.tags.push(a.newProduct.properties.genre),d.post(a.newProduct).then(function(){b.path("/productSearch")})},a.cancelNewProduct=function(){b.path("/productSearch")},$("#name").focus()}]),angular.module("tunariApp").controller("ProductSearcherCtrl",["$scope","$location","Products","ServerData","AlertMessages",function(a,b,c,d,e){c.getList().then(function(b){a.products=b,console.log(b[0])}),a.sampleBookSelected=0,a.shoppingCartSellings=[],a.alertMessages=e.getAlertMessages(),a.modals={sampleBook:!1,sellingItem:!1,productdetails:!1,background:!1},a.serverData=d,a.search=function(){c.getList({tags:a.tags}).then(function(b){a.products=b})},a.addToCart=function(b){console.log("jejejee"),_.contains(a.shoppingCartSellings,b)||a.shoppingCartSellings.push(b),a.hideModals()},a.showSampleBook=function(b){a.sampleBookSelected=a.products.indexOf(b),a.selectedProductSampleBook=b,a.modals.sampleBook=!0,a.modals.background=!0,a.hideAlertMessages()},a.selectProductToAdd=function(b){$("#addingProductQuantity").modal("toggle"),a.selectedProductToAdd=b},a.addingProduct=function(){a.selectedProductToAdd.quantity+=a.quantityToAdd,a.selectedProductToAdd.save(),$("#addingProductQuantity").modal("toggle"),a.quantityToAdd="",a.addingQuantityForm.$setPristine()},a.cancelAdding=function(){a.quantityToAdd="",a.addingQuantityForm.$setPristine(),$("#addingProductQuantity").modal("toggle")},a.showSellingItem=function(b){a.sellingItemData=b,a.savedsellingItemData=$.extend(!0,{},a.sellingItemData),a.modals.sellingItem=!0,a.modals.background=!0,a.hideAlertMessages(),window.scrollTo(0,0)},a.endSelling=function(b){b&&(a.alertMessages.message=b,a.alertMessages.show=!0),a.hideModals()},a.cancelSelling=function(){var b=a.shoppingCartSellings.indexOf(a.sellingItemData);a.shoppingCartSellings[b]=a.savedsellingItemData,a.hideModals()},a.hideModals=function(){a.modals.sampleBook=!1,a.modals.sellingItem=!1,a.modals.productdetails=!1,a.modals.background=!1},a.showDetails=function(c){a.alertMessages.show=!1,e.hideAlerts(),console.log(c),b.path("products/"+c)},a.hideAlertMessages=function(){a.alertMessages.show=!1,e.hideAlerts()},a.windowTop=function(){window.scrollTo(0,0)},$("#addingProductQuantity").on("shown.bs.modal",function(){$("#addingQuantity").focus()})}]),angular.module("tunariApp").directive("productdetails",function(){return{templateUrl:"../../views/productdetails.html",restrict:"EA",link:function(a,b){}}}),angular.module("tunariApp").directive("productlocation",function(){return{require:"ngModel",restrict:"EA",link:function(a,b,c,d){d.$parsers.push(function(a){var b=a,c=/^d(\w) e(\d+) p(\d+)$/,d=a.match(c);return d&&(b="Deposito "+d[1].toUpperCase()+", Estante "+d[2]+", PeldaÃ±o "+d[3]),b})}}}),angular.module("tunariApp").directive("samplebook",function(){return{templateUrl:"../../views/samplebook.html",restrict:"EA",link:function(a,b,c){}}}),angular.module("tunariApp").directive("sellingitem",function(){var a=["$scope",function(a){a.submitSelling=function(){},a.updateTotal=function(){a.sellingItemData.total=a.sellingItemData.quantity*a.sellingItemData.productPrice.value/a.sellingItemData.product.properties.quantityPerPackage,a.updateRevenue()},a.updateRevenue=function(){a.sellingItemData.revenue=a.sellingItemData.total-a.sellingItemData.product.buyingPrice*a.sellingItemData.quantity/a.sellingItemData.product.properties.quantityPerPackage,a.sellingItemData.revenue=parseFloat(a.sellingItemData.revenue.toFixed(2))},$("#quantity").focus()}];return{scope:{sellingItemData:"=",serverData:"=",addToCart:"&",endSelling:"&",cancelSelling:"&"},controller:a,templateUrl:"../../views/sellingItem.html",restrict:"EA"}}),angular.module("tunariApp").directive("sellingquantity",function(){return{require:"ngModel",restrict:"EA",scope:{maxQuantity:"@"},link:function(a,b,c,d){d.$parsers.push(function(b){var c=b,e=/^(\d+)[ #\*](\d+)$|(^\d+)$/,f=b.match(e);return f&&(f[1]&&f[2]?c=100*parseInt(f[1])+parseInt(f[2]):f&&f[3]&&(c=parseInt(f[3])),c>a.maxQuantity?(d.$setValidity("max_quantity",!1),c=void 0):d.$setValidity("max_quantity",!0)),c})}}}),angular.module("tunariApp").directive("shoppingcart",function(){var a=["$scope","Sellings",function(a,b){a.getTotalRevenue=function(){return _.reduce(a.sellingItems,function(a,b){return a+b.revenue},0)},a.getTotal=function(){return _.reduce(a.sellingItems,function(a,b){var c=a+b.total;return c=parseFloat(c.toFixed(2))},0)},a.selling={sellingItems:a.sellingItems},a.saveSelling=function(){$("#shoppingcartbody").collapse("hide"),a.client?a.selling.client=a.client:a.selling.client={name:"Desconocido",address:"Desconocido",phone:"9999999"},a.selling.sellingItems=a.sellingItems,a.selling.total=a.getTotal(),a.selling.revenue=a.getTotalRevenue(),_.each(a.selling.sellingItems,function(a){var b=a.product.quantity-a.quantity;a.product.quantity=b,a.product.put()}),b.post(a.selling).then(function(){a.sellingItems=[]});var c="Venta Exitosa!";a.endSelling()(c)},a.cleanSelling=function(){$("#shoppingcartbody").collapse("hide"),a.sellingItems=[]},$(".shopping-cart-body").css("max-height",$(window).height()/2.5)}];return{templateUrl:"../../views/shoppingcart.html",restrict:"EA",scope:{sellingItems:"=",serverData:"=",showSellingItem:"&",endSelling:"&"},controller:a}}),angular.module("tunariApp").directive("tagsproduct",function(){return{require:"ngModel",restrict:"EA",link:function(a,b,c,d){d.$formatters.push(function(a){var b=a;return b&&(b=a.join(" ")),b}),d.$parsers.push(function(a){var b=a;return b&&(b=a.split(" ")),b})}}}),angular.module("tunariApp").directive("typeahead",function(){var a=["$scope","Sellings","Clients",function(a,b,c){var d=new Bloodhound({datumTokenizer:function(){},queryTokenizer:Bloodhound.tokenizers.whitespace});a.exampleData={displayKey:"name",source:d.ttAdapter()},a.exampleOptions={highlight:!0},c.getList().then(function(b){d=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:b}),d.initialize(),a.exampleData={displayKey:"name",source:d.ttAdapter()}}),a.client=null}];return{template:'<input placeholder="Cliente..." class="typeahead sfTypeahead form-control" options="exampleOptions" datasets="exampleData"         ng-model="client"/>',scope:{client:"="},restrict:"EA",controller:a}}),angular.module("tunariApp").directive("uppercase",function(){return{require:"ngModel",restrict:"EA",link:function(a,b,c,d){d.$parsers.push(function(a){var b=a.toUpperCase();return b})}}}),angular.module("tunariApp").filter("checkedProduct",function(){return function(a,b,c){var d=[];return angular.forEach(a,function(a){var e=_.some(b.productSamples,function(b){return b==a.name});"Repartidos"==c?e&&d.push(a):"No Repartidos"==c?e||d.push(a):d.push(a)}),d}}),angular.module("tunariApp").service("AlertMessages",function(){var a={show:!1};this.getAlertMessages=function(){return a},this.setMessage=function(b){a.message=b,a.show=!0},this.hideAlerts=function(){a.show=!1}}),angular.module("tunariApp").service("Clients",["Restangular",function(a){return a.service("clients")}]),angular.module("tunariApp").factory("Products",["Restangular",function(a){return a.service("products")}]),angular.module("tunariApp").service("Sellings",["Restangular",function(a){return a.service("sellings")}]),angular.module("tunariApp").service("ServerData",function(){this.urlImages="http://10.0.0.5:8000/images/",this.invitations={},this.invitations.genres=["Hombre","Mujer","Unisex"],this.invitations.types=["Mementos","Bautizos","Matrimonios"],this.invitations.sizes=["Postal","Esquela","Doble Postal","Doble Esquela"],this.products={categories:["Invitaciones"]}});